{{ define "main" }}

{{ $isParentJob := isset .Page.Parent.Params "job_name" }}
{{ $job := cond $isParentJob .Page.Parent .Page.Parent.Parent }}
{{ $role := $job.Parent.Params.role }}

<div class="space-y-8 sm:space-y-16">
  {{ $header := dict
    "role" $role
    "job" $job.Params.job_name
    "jobTitle" $job.Title
    "title" .Title
    "icon" "/theme-assets/armoury.svg"
    "lastmod" .Params.lastmod
    "patch" .Params.patch
    "pageContext" .
  }}
  {{ partial "job/single_header.html" $header }}

  <div class="container mx-auto lg:px-8">
    <div class="md:grid grid-cols-12 items-start gap-8 w-full">
      <div class="mx-4 sm:mx-0 table-of-contents-container max-h-screen overflow-y-auto">
        {{ partial "components/bis_toc.html" . }}
      </div>
      <div class="job-guides-container">
        <div class="markdown max-w-none">
          {{ range $index, $bis := .Params.bis }}
          <h2 id="{{ $index }}">{{ $bis.name }}</h2>
          {{ $partialPath := printf "components/embeds/%s.html" $bis.type }}
          {{ if templates.Exists (printf "partials/%s" $partialPath) }}
          {{ partial $partialPath $bis.link }}
          {{ else }}
          {{/* Fallback to generic link if no template matches.
          This shouldn't generally happen.
          */}}
          {{ partial "components/embeds/genericlink.html" $bis.link }}
          {{ end }}
          {{ if $bis.description }}
          {{ $bis.description | markdownify }}
          {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
  </div>

  <div class="responsive-container">
    {{ partial "components/guide_meta_slider.html" . }}
  </div>

  {{/* <div class="py-14 bg-no-repeat bg-cover" style="background-image: url('/theme-assets/jobs/{{ lower $role }}/{{ lower $role }}_resources_background.png');">
    {{ partial "job/job_resources.html" .Parent }}
  </div> */}}

  {{/* {{ partial "job/role_resources.html" .Parent }} */}}

</div>
{{ end }}
